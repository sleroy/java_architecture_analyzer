# JBoss EJB 2 to Spring Boot Migration Plan
# Phase 0: Pre-Migration Assessment and Preparation
# Phase 1: Spring Boot Project Initialization (Tasks 000-101)

migration-plan:
  name: "JBoss EJB 2 to Spring Boot Migration - Phase 0 & 1"
  version: "1.0.0"
  description: |
    Comprehensive migration from JBoss EJB 2 to Spring Boot.
    This plan covers initial assessment, preparation, and Spring Boot project initialization.
    Includes tasks TASK-000 through TASK-101.
  
  metadata:
    author: "Migration Team"
    created-date: "2025-01-30"
    target-spring-boot-version: "2.7.18"
    source-jboss-version: "7.x"
  
  # Global variables available to all tasks
  variables:
    project_root: "${project.root}"
    spring_boot_version: "2.7.18"
    java_version: "8"
    group_id: "com.example.ejbapp"
    artifact_id: "example/springboot"
    package_base: "com.example.ejbapp"
    migration_branch_prefix: "migration"
    
  phases:
    # ========================================================================
    # PHASE 0: PRE-MIGRATION ASSESSMENT AND PREPARATION
    # ========================================================================
    - id: "phase-0"
      name: "Pre-Migration Assessment and Preparation"
      description: "Environment setup and baseline establishment"
      
      tasks:
        # ====================================================================
        # TASK-000: Project Baseline Documentation
        # ====================================================================
        - id: "task-000"
          name: "Project Baseline Documentation"
          description: "Establish a clear baseline of the current application state before migration begins"
          
          blocks:
            # Step 1: Create baseline branch
            - type: "COMMAND"
              name: "create-baseline-branch"
              description: "Create Git branch for baseline documentation"
              command: |
                git checkout -b ${migration_branch_prefix}/springboot-baseline
              working-directory: "${project_root}"
              timeout-seconds: 30
              capture-output: true
              
            # Step 2: Query EJB inventory from graph database
            - type: "GRAPH_QUERY"
              name: "query-all-ejb-components"
              description: "Query all EJB components from the analyzed codebase"
              query-type: "BY_TAGS"
              tags:
                - "ejb.session"
                - "ejb.entity"
                - "ejb.mdb"
              output-variable: "ejb_inventory"
              
            # Step 3: Query stateless session beans specifically
            - type: "GRAPH_QUERY"
              name: "query-stateless-beans"
              description: "Query all stateless session beans"
              query-type: "BY_TAGS"
              tags:
                - "ejb.session.stateless"
              output-variable: "stateless_beans"
              
            # Step 4: Query CMP entities
            - type: "GRAPH_QUERY"
              name: "query-cmp-entities"
              description: "Query all Container Managed Persistence entities"
              query-type: "BY_TAGS"
              tags:
                - "ejb.entity.cmp"
              output-variable: "cmp_entities"
              
            # Step 5: Query message-driven beans
            - type: "GRAPH_QUERY"
              name: "query-message-driven-beans"
              description: "Query all Message-Driven Beans"
              query-type: "BY_TAGS"
              tags:
                - "ejb.mdb"
              output-variable: "mdb_beans"
              
            # Step 6: Export database schema
            - type: "COMMAND"
              name: "export-database-schema"
              description: "Export current database schema using mysqldump"
              command: |
                mysqldump --no-data --skip-add-drop-table \
                  -h localhost -u ${DB_USER} -p${DB_PASSWORD} \
                  ${DB_NAME} > baseline-schema.sql
              working-directory: "${project_root}/docs/baseline"
              timeout-seconds: 120
              capture-output: true
              
            # Step 7: Generate AI prompt for baseline documentation
            - type: "AI_PROMPT"
              name: "generate-baseline-analysis"
              description: "Generate comprehensive baseline documentation using AI"
              prompt: |
                Based on the EJB component analysis, create a comprehensive baseline documentation.
                
                ## EJB Inventory Summary
                
                Total EJB Components: ${ejb_inventory_summary.count}
                - Stateless Session Beans: ${stateless_beans_summary.count}
                - CMP Entities: ${cmp_entities_summary.count}
                - Message-Driven Beans: ${mdb_beans_summary.count}
                
                ## Stateless Session Beans
                ${stateless_beans_ids}
                
                ## CMP Entities
                ${cmp_entities_ids}
                
                ## Message-Driven Beans
                ${mdb_beans_ids}
                
                Please analyze this inventory and provide:
                1. Architecture overview based on discovered components
                2. Migration complexity assessment (High/Medium/Low)
                3. Key migration risks identified
                4. Recommended migration sequence for these components
                5. Estimated effort (person-days) for each component type
                
                Focus on technical accuracy and actionable recommendations.
              output-variable: "baseline_analysis"
              temperature: 0.3
              max-tokens: 2000
              
            # Step 8: Create baseline documentation file
            - type: "FILE_OPERATION"
              name: "create-baseline-document"
              description: "Create BASELINE.md with comprehensive documentation"
              operation: "CREATE"
              path: "${project_root}/docs/BASELINE.md"
              content: |
                # Application Baseline Documentation
                
                **Generated:** ${current_datetime}
                **Branch:** ${migration_branch_prefix}/springboot-baseline
                
                ## Executive Summary
                
                This document captures the baseline state of the JBoss EJB 2 application before migration to Spring Boot.
                
                ## EJB Component Inventory
                
                ### Summary Statistics
                - **Total EJB Components:** ${ejb_inventory_summary.count}
                - **Stateless Session Beans:** ${stateless_beans_summary.count}
                - **CMP Entities:** ${cmp_entities_summary.count}
                - **Message-Driven Beans:** ${mdb_beans_summary.count}
                
                ### Stateless Session Beans
                
                The following stateless session beans have been identified:
                
                ${stateless_beans_ids}
                
                These beans will be migrated to Spring @Service components with @Transactional annotations.
                
                ### CMP Entities
                
                The following Container Managed Persistence entities have been identified:
                
                ${cmp_entities_ids}
                
                These entities will be migrated to JPA entities with Spring Data repositories.
                
                ### Message-Driven Beans
                
                The following Message-Driven Beans have been identified:
                
                ${mdb_beans_ids}
                
                These MDBs will be migrated to Spring JMS listeners or Spring Integration components.
                
                ## AI-Generated Analysis
                
                ${baseline_analysis}
                
                ## Database Schema
                
                Database schema has been exported to baseline-schema.sql
                
                ## Next Steps
                
                1. Review this baseline with technical team
                2. Validate completeness of component inventory
                3. Proceed to TASK-001: Create Migration Branch Structure
              
            # Step 9: Manual validation checkpoint
            - type: "INTERACTIVE_VALIDATION"
              name: "verify-baseline-documentation"
              description: "Human verification of baseline documentation"
              validation-type: "MANUAL_CONFIRM"
              message: |
                Please verify the baseline documentation:
                
                - Git branch created: ${migration_branch_prefix}/springboot-baseline
                - BASELINE.md created at: ${project_root}/docs/BASELINE.md
                - Database schema exported to: baseline-schema.sql
                - EJB inventory captured: ${ejb_inventory_summary.count} components
                
                Review the BASELINE.md file and confirm:
                1. All critical EJB components are documented
                2. Component counts match your expectations
                3. AI analysis provides useful insights
                4. Database schema export is complete
                
                Type yes to proceed or no to abort and review.
              required: true
              timeout-seconds: 3600
              
        # ====================================================================
        # TASK-001: Create Migration Branch Structure
        # ====================================================================
        - id: "task-001"
          name: "Create Migration Branch Structure"
          description: "Set up parallel development structure to enable incremental migration"
          
          blocks:
            # Step 1: Create main migration branch
            - type: "COMMAND"
              name: "create-migration-branch"
              description: "Create main migration branch"
              command: |
                git checkout -b ${migration_branch_prefix}/springboot-initial
              working-directory: "${project_root}"
              timeout-seconds: 30
              
            # Step 2-6: Create directory structure
            - type: "COMMAND"
              name: "create-directory-structure"
              description: "Create complete Spring Boot directory structure"
              command: |
                mkdir -p example/springboot/src/main/java
                mkdir -p example/springboot/src/main/resources
                mkdir -p example/springboot/src/test/java
                mkdir -p example/springboot/src/test/resources
              working-directory: "${project_root}"
              timeout-seconds: 30
              
            # Step 3: Create .gitignore
            - type: "FILE_OPERATION"
              name: "create-gitignore"
              description: "Create .gitignore file for Spring Boot project"
              operation: "CREATE"
              path: "${project_root}/example/springboot/.gitignore"
              content: |
                # Compiled class files
                *.class
                
                # Log files
                *.log
                logs/
                
                # Maven
                target/
                
                # IDE
                .idea/
                *.iml
                .vscode/
                
                # OS
                .DS_Store
                
                # Application-specific
                application-local.properties
                
            # Step 4: Create initial README
            - type: "FILE_OPERATION"
              name: "create-readme"
              description: "Create README.md for Spring Boot project"
              operation: "CREATE"
              path: "${project_root}/example/springboot/README.md"
              content: |
                # Unicorn Spring Boot Application
                
                This is the Spring Boot version of the Unicorn application, migrated from JBoss EJB 2.
                
                ## Project Status
                
                Under Active Development - Migration in progress
                
                ## Prerequisites
                
                - Java ${java_version} or higher
                - Maven 3.6+
                - MySQL 8.0+
                
                ## Building the Application
                
                mvn clean package
                
                ## Running the Application
                
                mvn spring-boot:run
                
                ## Documentation
                
                - [Baseline Analysis](../docs/BASELINE.md)
                - [Migration Strategy](../docs/MIGRATION_STRATEGY.md)
                - [Dependency Mapping](../docs/DEPENDENCY_MAPPING.md)
                
            # Step 5: Create migration strategy document
            - type: "FILE_OPERATION"
              name: "create-migration-strategy"
              description: "Create MIGRATION_STRATEGY.md document"
              operation: "CREATE"
              path: "${project_root}/docs/MIGRATION_STRATEGY.md"
              content: |
                # Migration Strategy: JBoss EJB 2 to Spring Boot
                
                ## Overview
                
                This document outlines the strategy for migrating the Unicorn application from JBoss EJB 2 to Spring Boot ${spring_boot_version}.
                
                ## Migration Approach
                
                We will use a strangler fig pattern approach:
                1. Build new Spring Boot application in parallel
                2. Migrate components incrementally
                3. Maintain both versions during transition
                4. Cut over when Spring Boot version reaches feature parity
                
                ## EJB to Spring Mapping
                
                - @Stateless → @Service + @Transactional
                - @Entity (CMP) → @Entity (JPA) + JpaRepository
                - @MessageDriven → @JmsListener or Spring Integration
                - @Inject → @Autowired or Constructor Injection
                - @Produces → @Bean
                - persistence.xml → application.properties
                - @Path (JAX-RS) → @RequestMapping
                - EntityManager → JpaRepository
                
                ## Success Criteria
                
                Migration will be considered successful when:
                - All EJB components migrated to Spring equivalents
                - All REST endpoints functional in Spring Boot
                - All tests passing
                - Performance meets or exceeds baseline
                - Zero data loss during cutover
                - Application runs without JBoss dependencies
                
            # Step 6: Commit initial structure
            - type: "COMMAND"
              name: "commit-initial-structure"
              description: "Commit initial migration structure"
              command: |
                git add .
                git commit -m "feat: create Spring Boot migration structure

                - Created example/springboot directory structure
                - Added .gitignore for Spring Boot project
                - Created initial README.md
                - Documented migration strategy
                
                Related to: TASK-001"
              working-directory: "${project_root}"
              timeout-seconds: 60
              
            # Step 7: Validation checkpoint
            - type: "INTERACTIVE_VALIDATION"
              name: "verify-branch-structure"
              description: "Verify migration branch structure"
              validation-type: "MANUAL_CONFIRM"
              message: |
                Migration branch structure created successfully.
                
                - Branch: ${migration_branch_prefix}/springboot-initial
                - Directory structure: example/springboot/src/{main,test}/{java,resources}
                - .gitignore configured
                - README.md created
                - MIGRATION_STRATEGY.md documented
                - Changes committed to Git
                
                Please verify the structure matches expectations and proceed.
              required: true
              timeout-seconds: 1800
              
        # ====================================================================
        # TASK-002: Dependency Analysis and Mapping
        # ====================================================================
        - id: "task-002"
          name: "Dependency Analysis and Mapping"
          description: "Create complete mapping of JBoss dependencies to Spring Boot equivalents"
          
          blocks:
            # Step 1: Extract dependencies from existing POMs
            - type: "COMMAND"
              name: "extract-dependencies"
              description: "Extract all dependencies from existing POMs using Maven"
              command: |
                mvn dependency:tree -DoutputFile=docs/original-dependencies.txt
              working-directory: "${project_root}"
              timeout-seconds: 120
              
            # Step 2: Generate AI-powered dependency mapping
            - type: "AI_PROMPT"
              name: "generate-dependency-mapping"
              description: "Generate Spring Boot dependency mapping using AI"
              prompt: |
                Analyze the JBoss EJB 2 application dependencies and create a comprehensive mapping to Spring Boot ${spring_boot_version} equivalents.
                
                Based on the EJB inventory analysis:
                - Stateless Session Beans: ${stateless_beans_summary.count}
                - CMP Entities: ${cmp_entities_summary.count}
                - Message-Driven Beans: ${mdb_beans_summary.count}
                
                Provide Spring Boot dependency mappings for:
                
                1. EJB APIs (javax.ejb.*): Map to Spring Context and Transaction management
                2. JPA/Hibernate: Map to spring-boot-starter-data-jpa
                3. JAX-RS REST APIs: Map to spring-boot-starter-web
                4. CDI (javax.inject, javax.enterprise): Map to Spring Context
                5. JMS (if Message-Driven Beans exist): Map to spring-boot-starter-activemq
                6. Swagger (API documentation): Map to springdoc-openapi
                7. Validation APIs: Map to spring-boot-starter-validation
                
                For each mapping, provide:
                - Maven dependency coordinates
                - Version compatible with Spring Boot ${spring_boot_version}
                - Migration notes
                - Breaking changes to watch for
                
                Format as a markdown table for easy reference.
              output-variable: "dependency_mapping_analysis"
              temperature: 0.2
              max-tokens: 3000
              
            # Step 3: Create dependency mapping document
            - type: "FILE_OPERATION"
              name: "create-dependency-mapping-doc"
              description: "Create DEPENDENCY_MAPPING.md document"
              operation: "CREATE"
              path: "${project_root}/docs/DEPENDENCY_MAPPING.md"
              content: |
                # Dependency Mapping: JBoss EJB 2 to Spring Boot
                
                **Generated:** ${current_datetime}
                **Target Spring Boot Version:** ${spring_boot_version}
                **Java Version:** ${java_version}
                
                ## Overview
                
                This document maps all JBoss/Java EE dependencies to their Spring Boot equivalents.
                
                ## AI-Generated Mapping Analysis
                
                ${dependency_mapping_analysis}
                
                ## Core Spring Boot Starters Required
                
                - spring-boot-starter-web: REST APIs, embedded Tomcat
                - spring-boot-starter-data-jpa: JPA and Hibernate
                - spring-boot-starter-validation: Bean Validation
                - spring-boot-starter-actuator: Monitoring and metrics
                - spring-boot-starter-test: Testing framework
                
                ## Dependencies to Remove
                
                - jboss-ejb-api_3.1_spec (replaced by Spring Context)
                - cdi-api (replaced by Spring Context)
                - jboss-jaxrs-api_1.1_spec (replaced by Spring Web)
                - jboss-servlet-api_3.0_spec (included in Spring Boot)
                - hibernate-jpa-2.0-api (use JPA 2.2 from Spring Boot)
                
                ## Migration Notes
                
                1. No Direct EJB Replacement: Spring doesn't have direct EJB equivalents. Use @Service for stateless beans.
                2. Constructor Injection Preferred: Use constructor injection instead of field injection.
                3. No beans.xml Needed: Spring Boot auto-configuration replaces CDI beans.xml.
                4. Transaction Management: Use @Transactional instead of container-managed transactions.
                5. API Documentation: Migrate from Swagger 1.x to SpringDoc OpenAPI 3.
                
                ## Next Steps
                
                Proceed to TASK-100: Create Spring Boot Parent POM with mapped dependencies.
                
            # Step 4: Validation checkpoint
            - type: "INTERACTIVE_VALIDATION"
              name: "verify-dependency-mapping"
              description: "Review dependency mapping document"
              validation-type: "MANUAL_CONFIRM"
              message: |
                Dependency mapping completed.
                
                - Original dependencies extracted to: docs/original-dependencies.txt
                - AI analysis generated
                - DEPENDENCY_MAPPING.md created
                
                Please review:
                1. All critical dependencies are mapped
                2. Version compatibility is correct
                3. No essential dependencies are missing
                4. Migration notes address your concerns
                
                Proceed to create Spring Boot POM?
              required: true
              timeout-seconds: 1800
              
    # ========================================================================
    # PHASE 1: SPRING BOOT PROJECT INITIALIZATION
    # ========================================================================
    - id: "phase-1"
      name: "Spring Boot Project Initialization"
      description: "Bootstrap Spring Boot application structure"
      
      tasks:
        # ====================================================================
        # TASK-100: Create Spring Boot Parent POM
        # ====================================================================
        - id: "task-100"
          name: "Create Spring Boot Parent POM"
          description: "Initialize Spring Boot project with proper parent and dependency management"
          
          blocks:
            # Step 1: Create Spring Boot POM
            - type: "FILE_OPERATION"
              name: "create-spring-boot-pom"
              description: "Create pom.xml for Spring Boot project"
              operation: "CREATE"
              path: "${project_root}/example/springboot/pom.xml"
              content: |
                <?xml version="1.0" encoding="UTF-8"?>
                <project xmlns="http://maven.apache.org/POM/4.0.0"
                         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                         http://maven.apache.org/xsd/maven-4.0.0.xsd">
                    <modelVersion>4.0.0</modelVersion>
                    
                    <parent>
                        <groupId>org.springframework.boot</groupId>
                        <artifactId>spring-boot-starter-parent</artifactId>
                        <version>${spring_boot_version}</version>
                        <relativePath/>
                    </parent>
                    
                    <groupId>${group_id}</groupId>
                    <artifactId>${artifact_id}</artifactId>
                    <version>1.0.0-SNAPSHOT</version>
                    <packaging>jar</packaging>
                    
                    <name>Unicorn Spring Boot Application</name>
                    <description>Unicorn application migrated from JBoss EJB 2 to Spring Boot</description>
                    
                    <properties>
                        <java.version>${java_version}</java.version>
                        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
                        <maven.compiler.source>${java_version}</maven.compiler.source>
                        <maven.compiler.target>${java_version}</maven.compiler.target>
                    </properties>
                    
                    <dependencies>
                        <dependency>
                            <groupId>org.springframework.boot</groupId>
                            <artifactId>spring-boot-starter-web</artifactId>
                        </dependency>
                        
                        <dependency>
                            <groupId>org.springframework.boot</groupId>
                            <artifactId>spring-boot-devtools</artifactId>
                            <scope>runtime</scope>
                            <optional>true</optional>
                        </dependency>
                        
                        <dependency>
                            <groupId>org.springframework.boot</groupId>
                            <artifactId>spring-boot-starter-test</artifactId>
                            <scope>test</scope>
                        </dependency>
                    </dependencies>
                    
                    <build>
                        <finalName>${artifact_id}</finalName>
                        <plugins>
                            <plugin>
                                <groupId>org.springframework.boot</groupId>
                                <artifactId>spring-boot-maven-plugin</artifactId>
                            </plugin>
                        </plugins>
                    </build>
                </project>
                
            # Step 2: Validate POM
            - type: "COMMAND"
              name: "validate-pom"
              description: "Validate pom.xml and resolve dependencies"
              command: |
                mvn validate
              working-directory: "${project_root}/example/springboot"
              timeout-seconds: 120
              
            # Step 3: Compile to verify setup
            - type: "COMMAND"
              name: "test-compile"
              description: "Test compilation to verify Maven setup"
              command: |
                mvn clean compile
              working-directory: "${project_root}/example/springboot"
              timeout-seconds: 300
              
            # Step 4: Validation checkpoint
            - type: "INTERACTIVE_VALIDATION"
              name: "verify-pom-creation"
              description: "Verify Spring Boot POM creation"
              validation-type: "MANUAL_CONFIRM"
              message: |
                Spring Boot POM created successfully.
                
                - pom.xml created with Spring Boot ${spring_boot_version} parent
                - Java ${java_version} configured
                - Maven validation successful
                - Compilation successful
                
                Review the POM and confirm:
                1. Spring Boot version is correct
                2. Java version matches environment
                3. Dependencies resolve without errors
                4. Build configuration is appropriate
                
                Proceed to create main application class?
              required: true
              timeout-seconds: 1800
              
        # ====================================================================
        # TASK-101: Create Spring Boot Main Application Class
        # ====================================================================
        - id: "task-101"
          name: "Create Spring Boot Main Application Class"
          description: "Create the entry point for Spring Boot application"
          
          blocks:
            # Step 1: Create main application class
            - type: "FILE_OPERATION"
              name: "create-main-application-class"
              description: "Create UnicornApplication.java main class"
              operation: "CREATE"
              path: "${project_root}/example/springboot/src/main/java/br/com/semeru/UnicornApplication.java"
              content: |
                package com.example.ejbapp;
                
                import org.springframework.boot.SpringApplication;
                import org.springframework.boot.autoconfigure.SpringBootApplication;
                
                @SpringBootApplication
                public class UnicornApplication {
                    public static void main(String[] args) {
                        SpringApplication.run(UnicornApplication.class, args);
                    }
                }
                
            # Step 2: Create application.properties
            - type: "FILE_OPERATION"
              name: "create-application-properties"
              description: "Create application.properties configuration file"
              operation: "CREATE"
              path: "${project_root}/example/springboot/src/main/resources/application.properties"
              content: |
                # Application Configuration
                spring.application.name=example/springboot
                server.port=8080
                
                # Logging Configuration
                logging.level.com.example.ejbapp=DEBUG
                logging.level.org.springframework=INFO
                
            # Step 3: Test application startup
            - type: "COMMAND"
              name: "test-application-startup"
              description: "Test that Spring Boot application starts successfully"
              command: |
                timeout 30 mvn spring-boot:run &
                sleep 20
                pkill -f "spring-boot:run"
              working-directory: "${project_root}/example/springboot"
              timeout-seconds: 60
              
            # Step 4: Validation checkpoint
            - type: "INTERACTIVE_VALIDATION"
              name: "verify-application-startup"
              description: "Verify Spring Boot application starts successfully"
              validation-type: "MANUAL_CONFIRM"
              message: |
                Spring Boot main application class created successfully.
                
                - UnicornApplication.java created
                - application.properties configured
                - Application startup tested
                
                Verify:
                1. Application class exists at correct package location
                2. Application properties configured appropriately
                3. Application starts without errors
                4. Spring Boot banner displays
                5. Application accessible at http://localhost:8080
                
                The first 5 tasks are now complete!
                
                Next steps:
                - TASK-102: Add Actuator for Health Monitoring
                - TASK-200: Add Spring Data JPA Dependencies
                - Continue with remaining migration tasks
              required: true
              timeout-seconds: 1800
