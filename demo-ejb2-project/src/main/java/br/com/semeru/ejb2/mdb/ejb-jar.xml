<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ejb-jar PUBLIC "-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN" 
    "http://java.sun.com/dtd/ejb-jar_2_0.dtd">

<!-- 
    EJB 2.0 Deployment Descriptor for Message-Driven Beans
    
    This descriptor defines:
    - MDB configuration
    - JMS destination types (Queue, Topic)
    - Transaction management
    - Message acknowledgment mode
    - Message selectors (optional)
    
    Note: This is legacy EJB 2.0 configuration. Modern applications use annotations.
-->

<ejb-jar>
    <description>EJB 2.0 Message-Driven Beans Examples</description>
    <display-name>Message-Driven Beans</display-name>

    <enterprise-beans>
        
        <!-- Order Processor MDB (Queue-based) -->
        <message-driven>
            <description>
                Processes order messages from a JMS queue.
                Demonstrates point-to-point messaging pattern.
            </description>
            <display-name>OrderProcessorMDB</display-name>
            <ejb-name>OrderProcessorMDB</ejb-name>
            
            <!-- Bean Class -->
            <ejb-class>br.com.semeru.ejb2.mdb.OrderProcessorMDB</ejb-class>
            
            <!-- Transaction Type: Container-managed (CMT) -->
            <transaction-type>Container</transaction-type>
            
            <!-- Message Acknowledgment Mode -->
            <acknowledge-mode>Auto-acknowledge</acknowledge-mode>
            
            <!-- Message Destination Type -->
            <message-driven-destination>
                <destination-type>javax.jms.Queue</destination-type>
                <!-- Optional: Subscription durability for topics only -->
                <!-- <subscription-durability>NonDurable</subscription-durability> -->
            </message-driven-destination>
            
            <!-- Optional: Message Selector -->
            <!-- Filter messages based on properties -->
            <!-- <message-selector>orderType = 'PRIORITY' OR amount > 1000</message-selector> -->
            
            <!-- Security Identity (optional) -->
            <security-identity>
                <use-caller-identity/>
            </security-identity>
        </message-driven>
        
        <!-- Notification MDB (Topic-based) -->
        <message-driven>
            <description>
                Processes notification messages from a JMS topic.
                Demonstrates publish-subscribe messaging pattern.
                Multiple instances can receive the same message.
            </description>
            <display-name>NotificationMDB</display-name>
            <ejb-name>NotificationMDB</ejb-name>
            
            <!-- Bean Class -->
            <ejb-class>br.com.semeru.ejb2.mdb.NotificationMDB</ejb-class>
            
            <!-- Transaction Type: Container-managed (CMT) -->
            <transaction-type>Container</transaction-type>
            
            <!-- Message Acknowledgment Mode -->
            <acknowledge-mode>Auto-acknowledge</acknowledge-mode>
            
            <!-- Message Destination Type -->
            <message-driven-destination>
                <destination-type>javax.jms.Topic</destination-type>
                <!-- Subscription Durability -->
                <subscription-durability>NonDurable</subscription-durability>
            </message-driven-destination>
            
            <!-- Optional: Message Selector -->
            <!-- Example: Only process EMAIL notifications -->
            <!-- <message-selector>notificationType = 'EMAIL'</message-selector> -->
            
            <!-- Security Identity (optional) -->
            <security-identity>
                <use-caller-identity/>
            </security-identity>
        </message-driven>
        
    </enterprise-beans>

    <!-- Assembly Descriptor -->
    <assembly-descriptor>
        
        <!-- Container Transaction Management for OrderProcessorMDB -->
        <container-transaction>
            <method>
                <ejb-name>OrderProcessorMDB</ejb-name>
                <method-name>onMessage</method-name>
                <method-params>
                    <method-param>javax.jms.Message</method-param>
                </method-params>
            </method>
            <!-- 
                Transaction Attribute Options:
                - Required: Join existing transaction or create new one (default for MDB)
                - NotSupported: Execute without transaction
                - RequiresNew: Always create new transaction
            -->
            <trans-attribute>Required</trans-attribute>
        </container-transaction>
        
        <!-- Container Transaction Management for NotificationMDB -->
        <container-transaction>
            <method>
                <ejb-name>NotificationMDB</ejb-name>
                <method-name>onMessage</method-name>
                <method-params>
                    <method-param>javax.jms.Message</method-param>
                </method-params>
            </method>
            <trans-attribute>Required</trans-attribute>
        </container-transaction>
        
        <!-- Optional: Security Roles -->
        <!-- 
        <security-role>
            <description>Role for message processing</description>
            <role-name>message-processor</role-name>
        </security-role>
        -->
        
        <!-- Optional: Method Permissions -->
        <!-- 
        <method-permission>
            <role-name>message-processor</role-name>
            <method>
                <ejb-name>OrderProcessorMDB</ejb-name>
                <method-name>onMessage</method-name>
            </method>
        </method-permission>
        -->
        
    </assembly-descriptor>

</ejb-jar>
