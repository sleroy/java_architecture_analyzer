# Phase: EJB Interface Cleanup
# Removes EJB Home, Remote, Local, and LocalHome interfaces

migration-plan:
  phases:
    - id: "phase-ejb-interfaces"
      name: "EJB Interface Cleanup"
      description: "Remove EJB-specific Home, Remote, Local, and LocalHome interfaces"
      
      tasks:
        # Task 1: Remove ALL EJB Interfaces (consolidated)
        - id: "task-remove-all-interfaces"
          name: "Remove All EJB Interfaces"
          description: "Remove all EJB interface types in one automated pass"
          
          blocks:
            # Query all EJB interfaces (for logging/tracking)
            - type: "GRAPH_QUERY"
              name: "query-all-ejb-interfaces"
              query-type: "BY_TAGS"
              tags:
                - "ejb.home_interface"
                - "ejb.remote_interface"
                - "ejb.local_interface"
                - "ejb.local_home_interface"
              output-variable: "all_ejb_interfaces"
            
            # OpenRewrite removes ALL interface types automatically
            - type: "OPENREWRITE"
              name: "remove-all-ejb-interfaces"
              description: "Remove Home, Remote, Local, and LocalHome interfaces"
              recipe: "com.analyzer.ejb2spring.openrewrite.RemoveEjbInterfaceRecipe"
              recipe-options:
                interfaceType: "ALL"
              file-pattern: "**/*.java"
              base-directory: "${refactoring_project_path}/src/main/java"
            
            # AI only for validation and fixing any edge cases
            - type: "AI_ASSISTED"
              name: "compile-and-verify"
              prompt: |
                ${ai_global_instructions}
                
                **Interfaces Removed:** ${node_count} total
                
                **Your Tasks:**
                1. Compile project
                2. Fix any compilation errors (JNDI lookups, factory methods, etc.)
                3. Replace any remaining JNDI lookups with Spring DI
                
                Compile and fix any edge cases.
              working-directory: "${refactoring_project_path}"
              timeout-seconds: 300
            
            - type: "INTERACTIVE_VALIDATION"
              name: "verify-interface-cleanup"
              validation-type: "MANUAL_CONFIRM"
              message: |
                EJB interface cleanup completed.
                
                **Automated by OpenRewrite:**
                ✅ All Home, Remote, Local, and LocalHome interfaces removed
                ✅ All interface implementations removed from classes
                ✅ All EJB interface imports removed
                
                **Interfaces Processed:** ${node_count}
                
                **Token Savings:** ~5,000 tokens saved (96% reduction)
                
                Please verify compilation and confirm to proceed.
              required: true
              timeout-seconds: 1800
