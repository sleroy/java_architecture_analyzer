# Phase 1: Spring Boot Project Initialization
# Extracted from JBoss EJB 2 to Spring Boot Migration Plan

migration-plan:
  phases:
    - id: "phase-1"
      name: "Spring Boot Project Initialization"
      description: "Bootstrap Spring Boot application structure"
      
      tasks:
        - id: "task-100"
          name: "Create Spring Boot Parent POM"
          description: "Initialize Spring Boot project with proper parent and dependency management"
          
          blocks:
            - type: "COMMAND"
              name: "generate-springboot-project"
              description: "Generate Spring Boot project using Spring Initializr with baseline dependencies"
              command: |
                curl -G https://start.spring.io/starter.zip \
                  -d type=maven-project \
                  -d language=java \
                  -d bootVersion=${spring_boot_version} \
                  -d baseDir=semeru-springboot \
                  -d groupId=${group_id} \
                  -d artifactId=${artifact_id} \
                  -d name="Semeru Spring Boot Application" \
                  -d description="Semeru application migrated from JBoss EJB 2 to Spring Boot" \
                  -d packageName=${group_id}.${artifact_id} \
                  -d packaging=jar \
                  -d javaVersion=${java_version} \
                  -d dependencies=web,data-jpa,validation,actuator,devtools,configuration-processor,h2,mail,security,data-jdbc,jdbc,web-services,session \
                  -o springboot-baseline.zip
              working-directory: "${project_root}"
              timeout-seconds: 60
              
            - type: "COMMAND"
              name: "extract-springboot-project"
              description: "Extract generated Spring Boot project"
              command: |
                unzip -o springboot-baseline.zip
                rm springboot-baseline.zip
              working-directory: "${project_root}"
              timeout-seconds: 30
              
            - type: "AI_ASSISTED"
              name: "optimize-springboot-pom"
              description: "Optimize Spring Boot POM generated by Spring Initializr based on EJB analysis"
              prompt: |
                You are tasked with optimizing the Spring Boot ${spring_boot_version} POM file that was generated by Spring Initializr, based on the analysis of the existing JBoss EJB 2 application.
                
                ## Context Information
                
                **Spring Initializr Base**: A baseline Spring Boot project has been generated at ${project_root}/semeru-springboot/ with common dependencies (web, data-jpa, validation, actuator, devtools, security, mail, etc.)
                
                **Original Dependencies**: You can examine the original project POM files in ${project_root} directory and the extracted dependency tree at ${project_root}/docs/original-dependencies.txt
                
                **Dependency Mapping Analysis**: 
                ${dependency_mapping_analysis}
                
                **EJB Components Found**:
                - Stateless Session Beans: ${stateless_beans_summary.count}  
                - CMP Entities: ${cmp_entities_summary.count}
                - Message-Driven Beans: ${mdb_beans_summary.count}
                
                ## Your Task
                
                Please review the existing Spring Initializr-generated POM at ${project_root}/semeru-springboot/pom.xml and optimize it based on the JBoss EJB 2 analysis with the following requirements:
                
                1. **Base Configuration**:
                   - Use Spring Boot ${spring_boot_version} as parent
                   - Set Java version to ${java_version}  
                   - Use groupId: ${group_id}, artifactId: ${artifact_id}
                   - Version: 1.0.0-SNAPSHOT
                   - Packaging: jar
                
                2. **Essential Dependencies** (use latest compatible versions):
                   - spring-boot-starter-web (for REST APIs)
                   - spring-boot-starter-data-jpa (for JPA/Hibernate) 
                   - spring-boot-starter-validation (for Bean Validation)
                   - spring-boot-starter-actuator (for monitoring)
                   - spring-boot-devtools (for development)
                   - spring-boot-starter-test (for testing)
                
                3. **Conditional Dependencies** (add only if needed based on EJB analysis):
                   - spring-boot-starter-activemq or spring-boot-starter-amqp (if MDBs found: ${mdb_beans_summary.count} > 0)
                   - springdoc-openapi-starter-webmvc-ui (for API documentation)
                   - Database driver (MySQL, PostgreSQL, etc. - detect from original dependencies)
                
                4. **Migration-Specific Dependencies**:
                   - Any additional libraries needed for the migration process
                   - Testing libraries for integration testing
                
                5. **Plugins**:
                   - spring-boot-maven-plugin
                   - maven-compiler-plugin with proper Java version
                
                **Important Guidelines**:
                - Use the LATEST compatible versions for all dependencies within Spring Boot ${spring_boot_version} ecosystem
                - Remove all JBoss/JavaEE specific dependencies 
                - Ensure version compatibility between all dependencies
                - Add comments explaining any special dependency choices
                - Include profiles for different environments if needed (dev, test, prod)
                - Set appropriate project name and description
                
                Please provide the complete POM XML content that can be directly saved to the file.
              output-variable: "optimized_springboot_pom_content"
              timeout-seconds: 180
              
            - type: "FILE_OPERATION"
              name: "create-spring-boot-pom"
              description: "Create Spring Boot POM file with AI-optimized dependencies"
              operation: "CREATE"
              path: "${project_root}/semeru-springboot/pom.xml"
              content: "${optimized_springboot_pom_content}"
                
            - type: "COMMAND"
              name: "validate-pom"
              description: "Validate pom.xml and resolve dependencies"
              command: |
                mvn validate
              working-directory: "${project_root}/semeru-springboot"
              timeout-seconds: 120
              
            - type: "COMMAND"
              name: "test-compile"
              description: "Test compilation to verify Maven setup"
              command: |
                mvn clean compile
              working-directory: "${project_root}/semeru-springboot"
              timeout-seconds: 300
              
            - type: "INTERACTIVE_VALIDATION"
              name: "verify-pom-creation"
              description: "Verify Spring Boot POM creation"
              validation-type: "MANUAL_CONFIRM"
              message: |
                Spring Boot project initialized successfully using Spring Initializr + AI optimization.
                
                - Base project generated with Spring Initializr
                - POM optimized with AI analysis based on EJB components
                - Spring Boot ${spring_boot_version} parent configured
                - Java ${java_version} configured
                - Maven validation successful
                - Compilation successful
                
                Review the optimized POM and confirm:
                1. Spring Boot version is correct
                2. Java version matches environment
                3. Dependencies include EJB-specific mappings
                4. All dependencies resolve without errors
                5. Build configuration is appropriate
                6. AI optimization comments are helpful
                
                Proceed to create main application class?
              required: true
              timeout-seconds: 1800
              
        - id: "task-101"
          name: "Create Spring Boot Main Application Class"
          description: "Create the entry point for Spring Boot application"
          
          blocks:
            - type: "FILE_OPERATION"
              name: "create-main-application-class"
              description: "Create SemeruApplication.java main class"
              operation: "CREATE"
              path: "${project_root}/semeru-springboot/src/main/java/br/com/semeru/SemeruApplication.java"
              content: |
                package br.com.semeru;
                
                import org.springframework.boot.SpringApplication;
                import org.springframework.boot.autoconfigure.SpringBootApplication;
                
                @SpringBootApplication
                public class SemeruApplication {
                    public static void main(String[] args) {
                        SpringApplication.run(SemeruApplication.class, args);
                    }
                }
                
            - type: "FILE_OPERATION"
              name: "create-application-properties"
              description: "Create application.properties configuration file"
              operation: "CREATE"
              path: "${project_root}/semeru-springboot/src/main/resources/application.properties"
              content: |
                # Application Configuration
                spring.application.name=semeru-springboot
                server.port=8080
                
                # Logging Configuration
                logging.level.br.com.semeru=DEBUG
                logging.level.org.springframework=INFO
                
            - type: "COMMAND"
              name: "test-application-startup"
              description: "Test that Spring Boot application starts successfully"
              command: |
                timeout 30 mvn spring-boot:run &
                sleep 20
                pkill -f "spring-boot:run"
              working-directory: "${project_root}/semeru-springboot"
              timeout-seconds: 60
              
            - type: "INTERACTIVE_VALIDATION"
              name: "verify-application-startup"
              description: "Verify Spring Boot application starts successfully"
              validation-type: "MANUAL_CONFIRM"
              message: |
                Spring Boot main application class created successfully.
                
                - SemeruApplication.java created
                - application.properties configured
                - Application startup tested
                
                Verify:
                1. Application class exists at correct package location
                2. Application properties configured appropriately
                3. Application starts without errors
                4. Spring Boot banner displays
                5. Application accessible at http://localhost:8080
                
                The first 5 tasks are now complete!
                
                Next steps:
                - TASK-102: Add Actuator for Health Monitoring
                - TASK-200: Add Spring Data JPA Dependencies
                - Continue with remaining migration tasks
              required: true
              timeout-seconds: 1800
